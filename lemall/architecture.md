# 系统架构图

## 1. 架构分层

### ① 前端层
- **PC端商城前端**：`frontend/front_end_pc/`，主要为静态HTML、JS、CSS，负责用户购物、下单、个人中心等页面。
- **大数据可视化前端**：`frontend/BigDataVisualization/`，仪表盘、RFM分析、用户行为路径等可视化页面，iframe嵌入多种分析图表。
- **模板渲染**：`templates/`，Django后端渲染的HTML模板。

### ② 后端服务层（Django）
- **主项目配置**：`lemall/`，包含`settings.py`（配置数据库、缓存、Celery、第三方服务）、`urls.py`（主路由）、`wsgi.py`。
- **业务应用模块**（`apps/`）：
  - `users`：用户管理与认证
  - `goods`：商品管理
  - `orders`：订单管理
  - `carts`：购物车
  - `verifications`：验证码
  - `oauth`：第三方登录
  - `areas`：地区管理
  - `contents`：内容管理
  - `Management`：后台管理
  - `RecomSys`：智能推荐系统（基于PySpark+HDFS+机器学习）
- **工具与通用组件**：`utils/`，如商品、购物车工具、FastDFS文件上传等。
- **异步任务**：`celery_tasks/`，如短信、邮件发送，基于Celery+Redis。

### ③ 推荐系统与大数据分析
- **推荐系统**：`apps/RecomSys/`，通过PySpark读取HDFS上的大数据，构建用户-商品矩阵、商品画像、用户画像，进行个性化推荐，接口通过Django暴露。
- **大数据可视化**：前端通过iframe嵌入分析页面，后端可通过API提供数据。

### ④ 数据存储与中间件
- **数据库**：MySQL（主业务库+UBA分析库）
- **缓存/消息队列**：Redis（多DB分区，分别用于缓存、会话、验证码、浏览历史、购物车等）
- **分布式文件存储**：FastDFS（docker-compose中tracker/storage服务）
- **全文检索**：Haystack（配置于Django）

### ⑤ 部署与运维
- **容器化**：`docker-compose.yml`编排，包含Django、Celery、Redis、FastDFS、前端静态服务等容器。
- **日志与监控**：`logs/`目录存放日志。

## 2. 架构图（文字版）

```
┌─────────────────────────────┐
│         用户浏览器           │
│ ┌─────────────┐ ┌─────────┐ │
│ │PC商城前端   │ │大数据仪表盘│ │
│ └─────┬───────┘ └─────┬───┘ │
└───────┼───────────────┼─────┘
        │               │
        ▼               ▼
┌────────────────────────────────────────────┐
│                Django后端                  │
│ ┌────────────┬─────────────┬─────────────┐ │
│ │用户/商品等 │ 推荐系统    │ Celery异步  │ │
│ │业务模块    │ (PySpark+HDFS)│ 任务处理   │ │
│ └─────┬──────┴─────┬───────┴─────┬──────┘ │
│       │            │             │        │
│       ▼            ▼             ▼        │
│   MySQL         HDFS         Redis        │
│   (主+UBA)   (大数据存储) (缓存/队列/会话) │
│       │            │             │        │
│       └─────┬──────┴─────┬───────┘        │
│             ▼            ▼                │
│         FastDFS      Haystack             │
│      (分布式文件) (全文检索)              │
└────────────────────────────────────────────┘
```

## 3. 说明

- **前端**：用户通过PC端商城或大数据仪表盘访问系统，前端页面通过API与后端交互，部分页面通过iframe嵌入可视化内容。
- **后端**：Django作为主后端，负责业务逻辑、API接口、模板渲染、推荐系统API、异步任务调度等。
- **推荐系统**：利用PySpark从HDFS读取大数据，进行用户行为分析和个性化推荐，结果通过Django接口返回前端。
- **数据存储**：MySQL存储业务数据，Redis用于缓存、会话、消息队列，FastDFS用于图片/文件分布式存储，Haystack用于全文检索。
- **容器化部署**：所有服务通过docker-compose统一编排，便于开发、测试和生产部署。 