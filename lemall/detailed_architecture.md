# 详细系统架构图

## 1. 架构分层

### ① 前端层
- **PC端商城前端**：`frontend/front_end_pc/`，主要为静态HTML、JS、CSS，负责用户购物、下单、个人中心等页面。
  - **功能**：用户登录、注册、商品浏览、购物车管理、订单提交、个人中心。
  - **技术**：HTML、CSS、JavaScript、AJAX、jQuery。
- **大数据可视化前端**：`frontend/BigDataVisualization/`，仪表盘、RFM分析、用户行为路径等可视化页面，iframe嵌入多种分析图表。
  - **功能**：数据可视化、用户行为分析、RFM分析。
  - **技术**：ECharts、iframe、HTML、CSS、JavaScript。
- **模板渲染**：`templates/`，Django后端渲染的HTML模板。
  - **功能**：动态生成页面内容。
  - **技术**：Django模板引擎。

### ② 后端服务层（Django）
- **主项目配置**：`lemall/`，包含`settings.py`（配置数据库、缓存、Celery、第三方服务）、`urls.py`（主路由）、`wsgi.py`。
  - **功能**：系统配置、路由管理、WSGI服务。
  - **技术**：Django框架、Python。
- **业务应用模块**（`apps/`）：
  - `users`：用户管理与认证
    - **功能**：用户注册、登录、信息管理。
    - **技术**：Django认证系统、JWT。
  - `goods`：商品管理
    - **功能**：商品展示、搜索、分类。
    - **技术**：Django ORM、Haystack。
  - `orders`：订单管理
    - **功能**：订单创建、支付、状态管理。
    - **技术**：Django ORM、支付接口。
  - `carts`：购物车
    - **功能**：购物车添加、删除、更新。
    - **技术**：Django ORM、Redis。
  - `verifications`：验证码
    - **功能**：短信、邮件验证码发送。
    - **技术**：Celery、Redis。
  - `oauth`：第三方登录
    - **功能**：微信、QQ等第三方登录。
    - **技术**：OAuth2.0。
  - `areas`：地区管理
    - **功能**：地区信息管理。
    - **技术**：Django ORM。
  - `contents`：内容管理
    - **功能**：内容展示、管理。
    - **技术**：Django ORM。
  - `Management`：后台管理
    - **功能**：系统管理、数据统计。
    - **技术**：Django Admin。
  - `RecomSys`：智能推荐系统（基于PySpark+HDFS+机器学习）
    - **功能**：个性化推荐。
    - **技术**：PySpark、HDFS、机器学习算法。
- **工具与通用组件**：`utils/`，如商品、购物车工具、FastDFS文件上传等。
  - **功能**：通用工具、文件上传。
  - **技术**：FastDFS、Python。
- **异步任务**：`celery_tasks/`，如短信、邮件发送，基于Celery+Redis。
  - **功能**：异步任务处理。
  - **技术**：Celery、Redis。

### ③ 推荐系统与大数据分析
- **推荐系统**：`apps/RecomSys/`，通过PySpark读取HDFS上的大数据，构建用户-商品矩阵、商品画像、用户画像，进行个性化推荐，接口通过Django暴露。
  - **功能**：个性化推荐。
  - **技术**：PySpark、HDFS、机器学习算法。
- **大数据可视化**：前端通过iframe嵌入分析页面，后端可通过API提供数据。
  - **功能**：数据可视化。
  - **技术**：ECharts、iframe。

### ④ 数据存储与中间件
- **数据库**：MySQL（主业务库+UBA分析库）
  - **功能**：数据存储。
  - **技术**：MySQL。
- **缓存/消息队列**：Redis（多DB分区，分别用于缓存、会话、验证码、浏览历史、购物车等）
  - **功能**：缓存、会话管理、消息队列。
  - **技术**：Redis。
- **分布式文件存储**：FastDFS（docker-compose中tracker/storage服务）
  - **功能**：文件存储。
  - **技术**：FastDFS。
- **全文检索**：Haystack（配置于Django）
  - **功能**：全文搜索。
  - **技术**：Haystack、Elasticsearch。

### ⑤ 部署与运维
- **容器化**：`docker-compose.yml`编排，包含Django、Celery、Redis、FastDFS、前端静态服务等容器。
  - **功能**：服务编排、部署。
  - **技术**：Docker、Docker Compose。
- **日志与监控**：`logs/`目录存放日志。
  - **功能**：日志记录、监控。
  - **技术**：Python日志模块。

## 2. 架构图（文字版）

```
┌─────────────────────────────┐
│         用户浏览器           │
│ ┌─────────────┐ ┌─────────┐ │
│ │PC商城前端   │ │大数据仪表盘│ │
│ └─────┬───────┘ └─────┬───┘ │
└───────┼───────────────┼─────┘
        │               │
        ▼               ▼
┌────────────────────────────────────────────┐
│                Django后端                  │
│ ┌────────────┬─────────────┬─────────────┐ │
│ │用户/商品等 │ 推荐系统    │ Celery异步  │ │
│ │业务模块    │ (PySpark+HDFS)│ 任务处理   │ │
│ └─────┬──────┴─────┬───────┴─────┬──────┘ │
│       │            │             │        │
│       ▼            ▼             ▼        │
│   MySQL         HDFS         Redis        │
│   (主+UBA)   (大数据存储) (缓存/队列/会话) │
│       │            │             │        │
│       └─────┬──────┴─────┬───────┘        │
│             ▼            ▼                │
│         FastDFS      Haystack             │
│      (分布式文件) (全文检索)              │
└────────────────────────────────────────────┘
```

## 3. 说明

- **前端**：用户通过PC端商城或大数据仪表盘访问系统，前端页面通过API与后端交互，部分页面通过iframe嵌入可视化内容。
- **后端**：Django作为主后端，负责业务逻辑、API接口、模板渲染、推荐系统API、异步任务调度等。
- **推荐系统**：利用PySpark从HDFS读取大数据，进行用户行为分析和个性化推荐，结果通过Django接口返回前端。
- **数据存储**：MySQL存储业务数据，Redis用于缓存、会话、消息队列，FastDFS用于图片/文件分布式存储，Haystack用于全文检索。
- **容器化部署**：所有服务通过docker-compose统一编排，便于开发、测试和生产部署。 